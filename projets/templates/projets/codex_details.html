{% extends "projets/_navigation_codex.html" %}
{% load static %}
{% load i18n %}


{% block css %}
    <link rel="stylesheet" href="{% static "css/codex_details.css" %}"/>
{% endblock %}

{% block title %}{{ codex.title|truncatechars:14 }}{% endblock %}

{% block nav__codex-details %}menu__current-active{% endblock %}

{% block header %}
    <h1>{% trans "Codex - " %}{{ codex.title|title }}</h1>
    <h4>{{ codex.description }}</h4>
    <div class="codex-info">
        <input type="hidden" id="slug" value="{{ codex.slug }}"/>
        {% csrf_token %}
    </div>
{% endblock %}

{% block content %}
    <section class="simple-card simple-card--multiple-header page page--today">
        <section class="page__note-section">
            <header>
                <h2>{{ today_page.date }}</h2>
                <div class="header__image"></div>
            </header>
            <div class="note">
                {{ today_page.note_form.id }}
                {{ today_page.note_form.hash }}
                {{ today_page.note_form.text }}
            </div>
        </section>

        <section class="page__task-section">
            <header>
                <h2>{% trans "Tasks" %}</h2>
            </header>
            <div class="task task--new simple-list__row">
                {{ today_page.new_task_form.text }}
                <div class="button-container simple-list__right-icon ">
                    <button class="button task__add-item-button">{% trans "Add" %}</button>
                </div>
            </div>
            <div class="simple-list__separator"></div>
            <section class="task-list">
                {% for task in today_page.tasks_form reversed %}
                    <article class="task simple-list__row">
                        {{ task.id }}
                        {{ task.hash }}
                        {{ task.text }}
                        {# Div needed because an input checkbox can have a border#}
                        <div class="simple-list__right-icon">
                            {% include "projets/_checkbox.html" with input_class="task__is-achieved" input_name="is_achieved" input_id_name="task_checkbox_" input_id_counter=task.id.value input_is_checked=task.is_achieved.value only %}
                        </div>
                    </article>
                    <div class="simple-list__separator"></div>
                {% endfor %}
            </section>
        </section>
    </section>

    <section class="page-list">
        {% for page in older_pages  reversed %}
            <article
                    class="simple-card simple-card--multiple-header page{% if not page.note_form and page.tasks_form %} page--task-only{% endif %} ">
                {% if page.note_form %}
                    <section class="page__note-section">
                        <header>
                            <h2>{{ page.date }}</h2>
                            <button class="edit-pen div-like-button">&#128393;</button>
                        </header>
                        {% if page.note_form %}
                            <div class="note">
                                {{ page.note_form.id }}
                                {{ page.note_form.hash }}
                                <pre class="note__text disabled-textarea simple-list__text">{{ page.note_form.text.value }}</pre>
                            </div>
                        {% endif %}
                    </section>
                {% endif %}
                {% if page.tasks_form %}
                    <section class="page__task-section">
                        <header>
                            <h2>
                                {% if not page.note_form %}
                                    {{ page.date }}
                                {% else %}
                                    {% trans "Tasks" %}
                                {% endif %}
                            </h2>
                            <button class="edit-pen div-like-button">&#128393;</button>
                        </header>
                        <section class="task-list simple-list">
                            {% for task in page.tasks_form %}
                                <article class="task simple-list__row">
                                    {{ task.id }}
                                    {{ task.hash }}
                                    <pre class="task__text disabled-textarea simple-list__text">{{ task.text.value }}</pre>
                                    {# Div needed because an input checkbox can have a border#}
                                    <div class="simple-list__right-icon">
                                        {% include "projets/_checkbox.html" with input_class="task__is-achieved" input_name="is_achieved" input_id_name="task_checkbox_" input_id_counter=task.id.value input_is_checked=task.is_achieved.value only %}
                                    </div>
                                </article>
                                <div class="simple-list__separator"></div>
                            {% endfor %}
                        </section>
                    </section>
                {% endif %}
            </article>
        {% endfor %}
    </section>
{% endblock %}

{% block script %}
    <script src="{% static "js/jquery-3.2.1.min.js" %}"></script>
    <script src="{% static "js/autosize.min.js" %}"></script>
    <script src="{% static "js/jquery.typewatch.min.js" %}"></script>
    <script src="{% static 'js/ajaxq.js' %}"></script>
    <script src="{% static "js/basic.js" %}"></script>
    <script src="{% static "js/hash.js" %}"></script>
    <script src="{% static "js/note.js" %}"></script>
    <script src="{% static "js/task.js" %}"></script>
    <script src="{% static "js/codex_details.js" %}"></script>
{% endblock %}
